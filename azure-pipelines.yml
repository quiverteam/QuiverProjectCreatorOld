# Azure Pipelines build script for KeyValues
# installs opam and ocaml from apt, deps from opam, and build with dune

trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

steps:
- script: | 
    sudo apt install ocaml opam
    opam init -a
  displayName: 'install ocaml and opam'

- script: |
    opam install ocaml-system -y
    opam install angstrom -y
    opam install core -y
  displayName: 'install opam dependencies'

- script: |
    opam install dune -y
    # Start a new bash instance to load dune into the $PATH
    bash -c 'dune runtest'
  displayName: 'run dune tests'
